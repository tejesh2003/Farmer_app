<form [formGroup]="billForm" class="max-w-xl mx-auto mt-6 space-y-6 p-4 bg-gray-50 rounded-lg shadow">
  <input type="number" formControlName="farmerId"
         placeholder="Farmer ID"
         class="w-full p-2 border border-gray-300 rounded"/>

  <div formArrayName="fertilizers" class="space-y-2 mt-2">
    <div *ngFor="let fert of fertilizers.controls; let i = index"
         [formGroupName]="i"
         class="flex flex-wrap items-center gap-2">

      <div class="flex-1">
        <label class="block text-sm text-gray-700 mb-1">Fertilizer Name</label>
        <input type="text" formControlName="name" placeholder="e.g. Urea"
               class="w-full p-2 border border-gray-300 rounded"/>
      </div>

      <div>
        <label class="block text-sm text-gray-700 mb-1">Unit</label>
        <select formControlName="unit" class="p-2 border border-gray-300 rounded">
          <option value="kg">kg</option>
          <option value="L">L</option>
        </select>
      </div>

      <div>
        <label class="block text-sm text-gray-700 mb-1">Price</label>
        <input type="number" formControlName="price" placeholder="₹"
               class="w-24 p-2 border border-gray-300 rounded"/>
      </div>
    </div>
  </div>

  <button type="button" (click)="addFertilizer()"
          class="w-full py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
    + Add Fertilizer
  </button>

  <button type="button" (click)="getBill()"
          class="w-full py-2 bg-green-600 text-white rounded hover:bg-green-700">
    Get Bill
  </button>
</form>

<div *ngIf="billData" class="space-y-4 mt-6 max-w-xl mx-auto">
  <div class="text-center bg-green-100 text-green-800 font-semibold py-2 rounded text-lg">
    Total Cost: ₹{{ billData.total_cost }}
  </div>

  <div class="text-center text-sm text-gray-700">
    Bill for Farmer ID: {{ billData.farmer_id }}
  </div>

  <div *ngFor="let fert of billData.fertilizers | keyvalue"
       class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">

    <h3 class="text-lg font-semibold text-gray-800 mb-1">{{ fert.key }}</h3>

    <p class="text-sm text-gray-700">
      Total Quantity: {{ fert.value.total_quantity }} {{ fert.value.unit }}
    </p>
    <p class="text-sm text-gray-700">
      Price per Unit: ₹{{ fert.value.price_per_unit }}
    </p>
    <p class="text-sm text-gray-700 mb-2">
      Total Cost: ₹{{ fert.value.total_cost }}
    </p>

    <div class="border-t pt-2">
      <p class="text-sm font-medium text-gray-600">Farms:</p>
      <ul class="list-disc list-inside text-sm text-gray-600">
        <li *ngFor="let f of fert.value.farms">
          Farm {{ f.farm_id }} - {{ f.crop }} - {{ f.quantity }} {{ fert.value.unit }} due on {{ f.due_date }}
        </li>
      </ul>
    </div>
  </div>
</div>
